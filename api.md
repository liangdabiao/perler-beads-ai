1. # 接口简介 <span id="rykcugg4"></span>

即梦4.0是即梦同源的图像生成能力，该能力在统一框架内集成了文生图、图像编辑及多图组合生成的功能：支持单次输入最多 10 张图像及进行复合编辑，并能通过对提示词的深度推理，智能适配最优的图像比例尺寸与生成数量，可一次性输出最多 15 张内容关联的图像。此外，模型显著提升了中文生成的准确率与内容多样性，且支持 4K 超高清输出，为专业图像创作提供了从生成到编辑的一站式解决方案。

&nbsp;
2. # 能力优势 <span id="q9CLWxm8"></span>


|<div style="text-align: center">||\
|<h3 id="jiqNalQ4">多图输入输出：多模态批量生成，释放复合创意潜能</h3></div>| |\
| | |
|---|---|
|* **多图输入**：一次性输入多张图像，支持 **组合、迁移、替换、衍生** ** * * ** 等复合编辑，实现高难度合成 ||
|* <div style="text-align: center">|<div style="text-align: center">|\
|<strong><img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_8256a3b63d5b9f9f93fd0a3b61c2deae.png" width="782px" /></strong></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_2889dcbc02412496e7b5ea2cdd57cdf6.png" width="632px" /></div>|\
|||\
||<div style="text-align: center">|\
|<div style="text-align: center">|生成女孩和奶牛玩偶在游乐园开心地坐过山车，画幅4:3</div>|\
|将图1女子和图2男子合进一张画面，参考图3姿势</div>| |\
| | |
|* **多图（组图）输出 ：** 一次性输出多张图像，并且具备内容关联，做你创意脑暴/分镜创作的好帮手 ||
|<div style="text-align: center">|<div style="text-align: center">|\
|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_8ce18e5da1b9013f1ea8803c35d94f8d.png" width="856px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_836db3959168b527eabcbb9f5ff96448.png" width="864px" /></div>|\
|||\
|<div style="text-align: center">|<div style="text-align: center">|\
|参考画面风格，生成4张分别关于乌鸦、兔子、小狗、小猫盲盒的组图</div>|参考这张图，生成4张图，标题材质分别改为冰块、玻璃、毛绒、机械</div>|\
| | |

&nbsp;

|<div style="text-align: center">|||\
|<h3 id="wfStLnxc"><strong>超越 Agent 能力的API：深度理解意图，让技术适配创意</strong></h3></div>| | |\
| | | |
|---|---|---|
|* **深度理解意图：** 简单语言描述需求即可准确完成 增删、修改、替换、参考 等编辑效果，精准实现模糊需求的具象落地 |||
|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_d8b9899b85a58c230de03f0362aeeaee.png" width="460px" /></div>|</div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_68e30dfd68b5b50b656f15b2a77b77fd.png" width="608px" />根据草稿中的人物姿势，生成对应动作的手办</div>|\
||| |\
|<div style="text-align: center">|<div style="text-align: center">| |\
|转化为真人形象，帅气神秘</div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_d6a909a68d6630dd1190a6b3adf06051.png" width="540px" /></div>| |\
| || |\
| |<div style="text-align: center">| |\
| |参考线稿图，生成一台老式电视机</div>| |\
| | | |
|* **交互可控编辑：** 支持框选图片任意区域进行定向修改，提升创意自由度和操作可控性 |||
|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_8ef2c1f1e8a3d6376539052f1ca51e02.jpg" width="546px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_5c198009a4d4f2121978a2a8c8854ba6.png" width="566px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_58d1c38f405b6fb2044d02719fa530c2.png" width="588px" /></div>|\
| | | |
|* **比例和数量智能适配：** 支持手动指定，也支持根据提示词中的应用场景自动推理适配的比例尺寸和数量 |||
|<div style="text-align: center">|<span>![图片](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_7818db5718d8cb1e78b3cdf51adb4b7d.png) </span>|<span>![图片](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_1585207ecf8bb7a0a2ebd9b2aaf9e0a1.png) </span>|\
|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_cda90b8c7b191022def816fc7de1628c.png" width="559px" /></div>|> 参考图片形象生成一组搞怪、吐舌头的表情包 |> 生成三视图 |\
|| | |\
|> 参考图片形象生成一组日漫分镜 | | |

&nbsp;

|<div style="text-align: center">|||\
|<h3 id="Yi6OSDR6"><strong>多场景商用可控：从细节到效率，满足企业级严苛标准</strong></h3></div>| | |\
| | | |
|---|---|---|
|* **文字准确可控：** 针对文字生成的准确率优化；小字准确率极高；文字重复问题得到极大改善 |||
|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_79b5d13868bf65e87a904a072083e7c1.jpeg" width="456px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_b7e1c2ea3390d2fa49226e68495ab702.jpeg" width="456px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_473b10f8ec0b8dc96d5a0396c4e576fb.jpeg" width="422px" /></div>|\
|| | |\
|<div style="text-align: center">| | |\
|</div>| | |\
| | | |
|* **专业人像美化**：可高效完成人像修图， 最大化保留原图细节 |||
|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_097fb087674cf43165be2b76d623d56a.png" width="990px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_4d4a3a146c7a5159a4dfe2f75c10cb62.jpeg" width="608px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_048511c179da7c12f3cfd8a5b203fd15.jpeg" width="602px" /></div>|\
||||\
|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
|原图</div>|瘦脸</div>|美白</div>|\
| | | |
|* **超高清输出 ：** 分辨率再升级，最高支持4K分辨率生成，提供更大的后期编辑空间 |||
|<div style="text-align: center">|||\
|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_22b55e51d1150b23cb834aa7c270ecba.png" width="3122px" /></div>| | |\
|| | |\
| | | |


3. # 场景案例 <span id="4LD92aai"></span>


| |<div style="text-align: center">||| |\
| |Demo示例</div>| | | |\
| | | | | |
|---|---|---|---|---|
|**电商营销** |<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
| |<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_e626a8e47ca5acebe67161eb2d9f155d.png" width="960px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_6b6a09ea6090779c33fbf0ebd54f53f4.png" width="1280px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_0a8f72df669b7c4e90f5608a9c134916.png" width="3488px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_55c14d4d0d992e606238257bbe582595.png" width="4096px" /></div>|\
| |||||\
| |制作这个储粮罐的电商主图，把它放在温馨明亮的客厅一角，一只猫正在闻它| |实体替换，增加标题 | |\
| |&nbsp;| | | |\
| | | | | |
|**商业设计** |<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
| |<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_83d45c8ce26a5718fefab2e52a7cc1ec.png" width="1628px" />参考这个LOGO，做一套户外运动品牌视觉设计，品牌名称为“GREEN"，包括包装袋、帽子、纸盒、卡片、手环、挂绳等。绿色视觉主色调，趣味、简约现代风格</div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_913ba3a552caec2a78ae313acdd3b67b.jpeg" width="12720px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_c8210e1b716e9eac0ac00a421b14a427.png" width="1179px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_52265e5ab75670f6cbced03cb6d8f11e.png" width="3136px" /></div>|\
| | ||||\
| | | |根据图片设计一个原木奶油风的客厅，要有沙发、茶几和软装 | |
|**海报场景** |<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
| |<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_b424761aaaafa62fd6f43c023d1dc34f.png" width="1980px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_6b6a877b08fdb43b4397c41cb232af88.png" width="4096px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_0c3c7bd4c08270ce49c79da4620c052c.png" width="918px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_426d9fc531c002528a5ad0438e63f062.png" width="5812px" /></div>|\
| |||||\
| |图1人物不变，背景元素和文字排版变为图2，整体再高清一些 | |将海报分别改为上下排版、左右排版、包围式排版、四角式排版、三角形排版、中心排版、对称排版的7种不同排版 | |
|**影视动漫** |<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|<div style="text-align: center">|\
| |<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_fc39534e9a6c5e0f998630f4cf23e515.jpeg" width="1386px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_f76b99a085fec770084384d47c043a0a.png" width="2288px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_191d0e205f81c0d449fa20389a1015af.png" width="1920px" /></div>|<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_e7a867d4d4a7be9806146a397892e808.png" width="4083px" /></div>|\
| |||||\
| |参考这张图的画风，生成一组漫画： 1. 男孩在候机室里等待飞机 2. 男孩坐上飞机，开心的看着窗外 3. 男孩来到梦中情校 | |参考图片形象生成一组动作片分镜 | |
|**教育培训** |画一张海报，帮助人们了解熬夜的危害 |<div style="text-align: center">|制作哥特式教堂与巴洛克式宫殿的对比图，并在对应图片下方分别简要描述每种建筑风格的主要特征。 |<div style="text-align: center">|\
| | |<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_919f989f05cdabea9db41b52df376a0d.png" width="2688px" /></div>| |<img src="https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_8b58970c1acba1d5325bcd514010e63f.png" width="3552px" /></div>|\
| | || ||\
| | | | | |


&nbsp;
4. # Prompt建议 <span id="syuCpj7Q"></span>

用于文本生成图像的提示词 。建议：

* 建议用**连贯的自然语言**描述**画面内容（主体+行为+环境等），** 用**短词语**描述**画面美学（风格、色彩、光影、构图等）** 
* **组图生成：** 当有多图生成意图时，可以通过 **“一系列”“组图”“帮我生成几张图”** 等提示词触发组图，最多支持生成10张
* **比例指定：** 可在提示词中直接输入比例指令，也支持根据提示词中的应用场景自动推理适配的比例尺寸
* **提升文字准确率：** 把想要生成的文字内容插入“”引号中。例如：++生成一张海报，标题为“Seedream V4.0”++ 
* **提升指令响应：** 专业词汇使用词源语言，效果更准确
* **提升场景适配度：** 在有明确应用场景时，推荐写出图像用途和类型。 ** ** 例如：++用于 PPT封面背景++

&nbsp;
用于编辑图像的提示词 。建议：

* 用**清晰明确**的指令通常能实现更好的编辑效果，常见公式为 **变化动作 + 变化对象 + 变化特征**，如： ++将骑士的头盔变为金色++
* 当有明确需要保持的角色形象、产品信息、风格等特征时，你可以**输入图像作为参考**来保持一致性
* 使用精确的风格词或直接输入图像作为风格参考，有助于获得更理想的效果
* 上传多张参考图时，**明确指出不同图片需参考/编辑的不同元素**可提高精准度，例如：++将图1中的角色放入图2的背景中，参考图3的风格进行生成++


&nbsp;
###  <span id="a0qNWapz"></span>
5. # 服务开通 <span id="uo3DOhYh"></span>
* [开通服务](https://console.volcengine.com/ai/ability/detail/10)

<span>![图片](https://portal.volccdn.com/obj/volcfe/cloud-universal-doc/upload_15ef99cdda1c3f234763c6f0f9b93945.png =1433x) </span>
&nbsp;
<div style="text-align: center">
</div>


<span id="dIiGI4XW"></span>
# 接口简介
即梦4.0是即梦同源的图像生成能力，该能力在统一框架内集成了文生图、图像编辑及多图组合生成的功能：支持单次输入最多 10 张图像及进行复合编辑，并能通过对提示词的深度推理，自动适配最优的图像比例尺寸与生成数量，可一次性输出最多 15 张内容关联的图像。此外，模型显著提升了中文生成的准确率与内容多样性，且支持 4K 超高清输出，为专业图像创作提供了从生成到编辑的一站式解决方案。
&nbsp;
<span id="O4rpAIOQ"></span>
# 接入说明
<span id="PsrknMYN"></span>
## 限制条件

|名称 |内容 |
|---|---|
|输入图要求 |1. 图片格式：仅支持JPEG、PNG格式，建议使用JPEG格式；|\
| |2. 图片文件大小：最大 15MB，支持最多输入10张图；|\
| |3. 图片分辨率：最大 4096 \* 4096；|\
| |4. 输入图宽高比：（宽/高）范围：[1/3, 3] |
|输出图说明 |1. 输出图详细宽高规则，参考下方width、height中参数描述；|\
| |2. 输出图会以列表形式返回，最大输出图数量 = 15 \- 输入图数量； |
|其他说明 |1. 输出图片的分辨率越大、输出图片数量越多、输入图片数量越多，延迟增加越明显|\
| |2. 1次调用可能输出多张图片，根据输出图片张数进行计费，默认根据prompt理解意图判断输出图片数量|\
| |3. 若对延迟&价格敏感，建议使用force_single参数，强制只输出1张图片 |

<span id="GqsEOwRc"></span>
## 请求说明

|名称 |内容 |
|---|---|
|接口地址 |[https://visual.volcengineapi.com](https://visual.volcengineapi.com/) |
|请求方式 |POST |
|Content\-Type |application/json |

<span id="0wnQ3Dwc"></span>
## 提交任务
<span id="r4HK4rIK"></span>
### **提交任务请求参数**
<span id="OngKsQoc"></span>
#### **Query参数**
:::tip 拼接到url后的参数，示例：[https://visual.volcengineapi.com?Action=CVSync2AsyncSubmitTask&Version=2022-08-31](https://visual.volcengineapi.com?Action=CVSync2AsyncSubmitTask&Version=2022-08-31)

:::
|参数 |类型 |**可选/必选** |说明 |
|---|---|---|---|
|Action |string |必选 |接口名，取值：**CVSync2AsyncSubmitTask** |
|Version |string |必选 |版本号，取值：2022\-08\-31 |

<span id="V6PJyija"></span>
#### **Header参数**
:::warning
本服务固定值：**Region为cn\-north\-1，Service为cv**
:::
主要用于鉴权，详见 [公共参数](https://www.volcengine.com/docs/6369/67268) \- 签名参数 \- 在Header中的场景部分
<span id="UiKDbZzw"></span>
#### **Body参数**
:::warning
业务请求参数，放到request.body中，MIME\-Type为**application/json**

:::
|名称 |类型 |必选 |描述 |
|---|---|---|---|
|req_key |string |必选 |服务标识|\
| | | |取固定值: **jimeng_t2i_v40** |
|image_urls |array of string |可选 |图片文件URL，**支持输入0至10张图**|\
| | | ||\
| | | |* 图片数量越多&图片尺寸越大，整体服务处理时间越长|\
| | | |* 输入图片建议控制在6张图片以内，图片过多，参考效果会降低 |
|prompt |string |必选 |用于生成图像的提示词，中英文输入均可 。建议：|\
| | | ||\
| | | |* 最长不超过800字符，prompt过长有概率出图异常或不生效|\
| | | |* 支持 prompt中直接指定生图比例，模型会根据“size”字段智能判断生图宽高比，默认生成2K分辨率、宽高比不超过3的图像；|\
| | | |* 除“”外不建议输入特殊的符号如$ |
|size |int |可选|生成图片的面积，默认值：4194304 **，** 即2048\*2048，生成2K分辨率图像；|\
| | |文生图场景||\
| | ||* 取值范围：[1024\*1024, 4096\*4096]，可生成1K到4K分辨率图像；|\
| | |* 面积和宽高需要2选1传入，都不传则默认面积取“2048\*2048”，即生成2K分辨率图像且模型智能判断宽高比；|* 建议生成2k以上的图片，过小分辨率图片较大概率出现人脸效果不佳、文字异常等效果问题；若2K图片出图效果也不符合预期，可尝试输出更高分辨率图片 |\
| | |* 面积和宽高同时输入时，优先使用宽高；| |\
| | |* 只传面积，模型会根据用户prompt意图智能判断生图宽高比| |\
| | || |\
| | |图生图场景：| |\
| | || |\
| | |* 结合用户prompt意图、参考图尺寸，由模型智能判断生图宽高比 | |
|width |int |^^|1、生成图像宽高，默认该字段不传；|\
| | | |2、宽高乘积在[1024\*1024, 4096\*4096]，且宽高比在[min_ratio, max_ratio]之间|\
| | | |&nbsp;|\
| | | |注意：|\
| | | ||\
| | | |* 需同时传width和height才会生效|\
| | | ||\
| | | |&nbsp;|\
| | | |推荐可选的宽高：|\
| | | ||\
| | | |* 1K|\
| | | |   * 1024x1024 （1:1）|\
| | | |* 2K|\
| | | |   * 2048x2048 （1:1）|\
| | | |   * 2304x1728（4:3）|\
| | | |   * 2496x1664 （3:2）|\
| | | |   * 2560x1440 （16:9）|\
| | | |   * 3024x1296 （21:9）|\
| | | |* 4K|\
| | | |   * 4096x4096 （1:1）|\
| | | |   * 4694x3520（4:3）|\
| | | |   * 4992x3328 （3:2）|\
| | | |   * 5404x3040 （16:9）|\
| | | |   * 6198x2656 （21:9） |
|height |int |^^|^^|
|scale |float |可选 |文本描述影响的程度，该值越大代表文本描述影响程度越大，且输入图片影响程度越小（精度：支持小数点后两位）|\
| | | |默认值：0.5|\
| | | |取值范围：[0, 1] |
|force_single |bool |可选 |是否强制生成单图|\
| | | |默认值：false|\
| | | |&nbsp;|\
| | | |注意：|\
| | | ||\
| | | |* 生成的组图越多，耗时越久，且生成耗时会随图片数量增多而**显著变长**；|\
| | | |* 如需稳定的组图输出效果，建议prompt控制组图数量在**9张及以内**；|\
| | | |* 生成组图时，建议prompt明确指明图片分辨率或直接传参具体宽高值，避免模型生成组图分辨率不一致导致接口报错； |
|min_ratio |float |可选 |生图结果的宽/高 ≥ min_ratio，如果智能选比例 < min_ratio，则用min_ratio|\
| | | |默认值：1/3|\
| | | |取值范围：[1/16,16) |
|max_ratio |float |可选 |生图结果的宽/高 ≤ max_ratio，如果智能选比例 \> max_ratio，则用max_ratio|\
| | | |默认值：3|\
| | | |取值范围：[1/16,16) |

<span id="Cjr1lrpz"></span>
### 提交任务返回参数
<span id="1Vcaexl5"></span>
#### **通用返回参数**
请参考[通用返回字段及错误码](https://www.volcengine.com/docs/6444/69728)
<span id="Cn6u5bmF"></span>
#### **业务返回参数**
:::tip 重点关注data中以下字段，其他字段为公共返回(可忽略或不做解析)

:::
|字段 |类型 |说明 |
|---|---|---|
|task_id |string |任务ID，用于查询结果 |

<span id="JsCRrxGU"></span>
### 提交任务请求&返回完整示例
**请求示例：** 
```JSON
{
    "req_key": "jimeng_t2i_v40",
    "image_urls": [
        "https://xxxx",
        // ...
    ],
    "prompt": "背景换成演唱会现场",
    "scale": 0.5
}
```

**返回示例：** 
```JSON
{
    "code": 10000, //状态码，判断状态，code!=10000的情况下，不会返回task_id
    "data": {
        "task_id": "7392616336519610409" //任务ID，查询接口使用
    },
    "message": "Success",
    "request_id": "20240720103939AF0029465CF6A74E51EC", //排查错误的关键信息
    "time_elapsed": "104.852309ms" //链路耗时
}
```

<span id="JHUteyCY"></span>
## 查询任务
<span id="cLIJxaux"></span>
### **查询任务请求参数**
<span id="FVTYxWWm"></span>
#### **Query参数**
:::tip 拼接到url后的参数，示例：[https://visual.volcengineapi.com](https://visual.volcengineapi.com/)[?Action=CVSync2AsyncGetResult&Version=2022-08-31](https://visual.volcengineapi.com?Action=CVGetResult&Version=2022-08-31)

:::
|参数 |类型 |**可选/必选** |说明 |
|---|---|---|---|
|Action |string |必选 |接口名，固定值：**CVSync2AsyncGetResult** |
|Version |string |必选 |版本号，固定值：**2022\-08\-31** |

<span id="JrwBaH4A"></span>
#### **Header参数**
:::warning
本服务固定值：**Region为cn\-north\-1，Service为cv**
:::
主要用于鉴权，详见 [公共参数](https://www.volcengine.com/docs/6369/67268) \- 签名参数 \- 在Header中的场景部分
<span id="jXDfMRpe"></span>
#### **Body参数**
:::warning
业务请求参数，放到request.body中，MIME\-Type为**application/json**

:::
|参数 |类型 |可选/必选 |说明 |
|---|---|---|---|
|req_key |string |必选 |服务标识|\
| | | |取固定值: **jimeng_t2i_v40** |
|task_id |string |必选 |任务ID，此字段的取值为**提交任务接口**的返回 |
|req_json |JSON string |可选 |json序列化后的字符串|\
| | | |目前支持水印配置和是否以图片链接形式返回，可在返回结果中添加|\
| | | |示例："{\"logo_info\":{\"add_logo\":true,\"position\":0,\"language\":0,\"opacity\":1,\"logo_text_content\":\"这里是明水印内容\"},\"return_url\":true}" |

<span id="lMXbhvdz"></span>
##### **ReqJson(序列化后的结果再赋值给req_json)** 
配置信息

|**参数** |**类型** |**可选/必选** |**说明** |
|---|---|---|---|
|return_url |bool |可选 |输出是否返回图片链接  **（链接有效期为24小时）**  |
|logo_info |LogoInfo |可选 |水印信息 |
|aigc_meta |AIGCMeta |可选 |隐式标识|\
| | | |隐式标识验证方式：|\
| | | ||\
| | | |1. 查看【png】或【mp4】格式，人工智能生成合成内容表示服务平台（后续预计增加jpg）|\
| | | |* [https://www.gcmark.com/web/index.html#/mark/check/image](https://www.gcmark.com/web/index.html#/mark/check/image)|\
| | | |2. 查看【jpg】格式，使用app11 segment查看aigc元数据内容|\
| | | |* 如 [https://cyber.meme.tips/jpdump/#](https://cyber.meme.tips/jpdump/#) |

<span id="SKTq6y9R"></span>
##### **LogoInfo**
水印相关信息

|名称 |类型 |**可选/必选** |描述 |
|---|---|---|---|
|add_logo |bool |可选 |是否添加水印。True为添加，False不添加。默认不添加 |
|position |int |可选 |水印的位置，取值如下：|\
| | | |0\-右下角|\
| | | |1\-左下角|\
| | | |2\-左上角|\
| | | |3\-右上角|\
| | | |默认0 |
|language |int |可选 |水印的语言，取值如下：|\
| | | |0\-中文（AI生成）|\
| | | |1\-英文（Generated by AI）|\
| | | |默认0 |
|opacity |float |可选 |水印的不透明度，取值范围0\-1，1表示完全不透明，默认1 |
|logo_text_content |string |可选 |明水印自定义内容 |

<span id="PxqKv1ac"></span>
##### AIGCMeta
隐式标识，依据《人工智能生成合成内容标识办法》&《网络安全技术人工智能生成合成内容标识方法》

|名称 |类型 |**可选/必选** |描述 |
|---|---|---|---|
|content_producer |String |可选 |内容生成服务ID |
|producer_id |String |必选 |内容生成服务商给此图片数据的唯一ID |
|content_propagator |String |可选 |内容传播服务商ID |
|propagate_id |String |可选 |传播服务商给此图片数据的唯一ID |

<span id="gBNyimdk"></span>
### 查询任务返回参数
<span id="43JbFxKn"></span>
#### **通用返回参数**
请参考[通用返回字段及错误码](https://www.volcengine.com/docs/6444/69728)
<span id="M2SCSug4"></span>
#### **业务返回参数**
:::tip
重点关注data中以下字段，其他字段为公共返回(可忽略或不做解析)

:::
|参数名 |参数说明 |参数示例 |
|---|---|---|
|binary_data_base64 |array of string |返回图片的base64数组。 |
|image_urls |array of string |返回图片的url数组，输出图片格式为png格式（**有效期是24h**） |
|status |string |任务执行状态|\
| | ||\
| | |* in_queue：任务已提交|\
| | |* generating：任务已被消费，处理中|\
| | |* done：处理完成，成功或者失败，可根据外层code&message进行判断|\
| | |* not_found：任务未找到，可能原因是无此任务或任务已过期(12小时)|\
| | |* expired：任务已过期，请尝试重新提交任务请求 |

<span id="5XZgJBb1"></span>
### 查询任务请求&返回完整示例
**请求示例：** 
```JSON
{
    "req_key": "jimeng_t2i_v40",
    "task_id": "<任务提交接口返回task_id>",
    "req_json":"{\"logo_info\":{\"add_logo\":true,\"position\":0,\"language\":0,\"opacity\":1,\"logo_text_content\":\"这里是明水印内容\"},\"return_url\":true}"
}
```

**返回示例：** 
```JSON
{
    "code": 10000, //状态码，优先判断 code=10000, 然后再判断data.status，否则解析有可能会panic
    "data": {
        "binary_data_base64": null,
        "image_urls": [
            "https://xxxx",
            // ...
        ],
        "status": "done"  //任务状态
    },
    "message": "Success",
    "status": 10000,  //无需关注，请忽略
    "request_id": "2025061718460554C9B78D23B0BAB45B2A",  //排查错误的关键信息
    "time_elapsed": "508.312154ms" //链路耗时
}
```

**返回报错示例：** 
```JSON
{
    "code": 50413, //状态码，优先判断 code=10000, 然后再判断data.status，否则解析有可能会panic
    "data": null, //code!=10000的情况下，该字段返回为null
    "message": "Post Text Risk Not Pass", //错误信息
    "request_id": "202511281418218670D408837A9B0EB58F", //排查错误的关键信息
    "status": 50413, //无需关注，请忽略
    "time_elapsed": "36.799829ms" //链路耗时
}
```

<span id="ikGau89R"></span>
## 错误码
<span id="IEOXhs1W"></span>
## 错误码
<span id="okkRAhsw"></span>
### **通用错误码**
请参考[通用返回字段及错误码](https://www.volcengine.com/docs/6444/69728)
<span id="LiZ6iqrr"></span>
### **业务错误码**

|HttpCode |错误码 |错误消息 |描述 |是否需要重试 |
|---|---|---|---|---|
|200 |10000 |无 |请求成功 |不需要 |
|400 |50411 |Pre Img Risk Not Pass |输入图片前审核未通过 |不需要 |
|400 |50511 |Post Img Risk Not Pass |输出图片后审核未通过 |可重试 |
|400 |50412 |Text Risk Not Pass |输入文本前审核未通过 |不需要 |
|400 |50512 |Post Text Risk Not Pass |输出文本后审核未通过 |不需要 |
|400 |50413 |Post Text Risk Not Pass |输入文本含敏感词、版权词等审核不通过 |不需要 |
|400 |50518 |Pre Img Risk Not Pass: Copyright |输入版权图前审核未通过 |不需要 |
|400 |50519 |Post Img Risk Not Pass: Copyright |输出版权图后审核未通过 |可重试 |
|400 |50520 |Risk Internal Error |审核服务异常 |不需要 |
|400 |50521 |Antidirt Internal Error |版权词服务异常 |不需要 |
|400 |50522 |Image Copyright Internal Error |版权图服务异常 |不需要 |
|429 |50429 |Request Has Reached API Limit, Please Try Later |QPS超限 |可重试 |
|429 |50430 |Request Has Reached API Concurrent Limit, Please Try Later |并发超限 |可重试 |
|500 |50500 |Internal Error |内部错误 |不需要 |
|500 |50501 |Internal RPC Error |内部算法错误 |不需要 |

&nbsp;
<span id="BbKrAsaR"></span>
## 接入说明
<span id="SCi3tVo6"></span>
### SDK使用说明
请参考[SDK使用说明](https://www.volcengine.com/docs/6444/1340578)
<span id="BGyXT4Ww"></span>
### HTTP方式接入说明
请参考[HTTP请求示例](https://www.volcengine.com/docs/6444/1390583)
&nbsp;








<span id="#3c8515dd"></span>
# 前置说明（必读）
以下内容为直接使用HTTP方式调用接口的请求示例(包含签名过程)，替换关键信息即可直接调用。
**Step1(必需):** 通过火山访问控制获取AK/SK，需确保火山账号已开通对应权限和相关策略

* 正确替换示例中的`AccessKeyID`和`SecretAccessKey`参数值
* 无权限情况下会报错“”

**Step2(大多数情况下可跳过):** 查看接口文档`请求参数-Query参数`中的`Action`及对应`Version`

* 正确替换示例中的`action`和 `version`参数值

**Step3(必需):** 查看接口文档`请求参数-Body参数、请求示例`，将`请求示例`内容复制到`调用示例的body入参部分`

* 正确替换示例中的Body入参

**Step4:** 运行程序进行调试即可，待测试调通后，可以按需集成到项目中(不建议直接Copy，建议自行适配或更新包)
<span id="#fc80385f"></span>
# 调用示例
<span id="#d35c0a07"></span>
## **Java**
```Java
package com.volcengine.example.cv;

import com.alibaba.fastjson.JSONObject;
import com.google.common.io.ByteStreams;
import com.volcengine.helper.Utils;
import org.apache.commons.codec.binary.Hex;
import javax.crypto.Mac;
import javax.crypto.spec.SecretKeySpec;
import java.io.InputStream;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import java.nio.ByteBuffer;
import java.nio.charset.Charset;
import java.nio.charset.StandardCharsets;
import java.security.MessageDigest;
import java.text.SimpleDateFormat;
import java.util.*;

/**
 * Copyright (year) Beijing Volcano Engine Technology Ltd.
 * <p>
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * <p>
 * http://www.apache.org/licenses/LICENSE-2.0
 * <p>
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
public class Sign {
    private static final BitSet URLENCODER = new BitSet(256);
    private static final String CONST_ENCODE = "0123456789ABCDEF";
    public static final Charset UTF_8 = StandardCharsets.UTF_8;
    private final String region;
    private final String service;
    private final String schema;
    private final String host;
    private final String path;
    private final String ak;
    private final String sk;

    static {
        int i;
        for (i = 97; i <= 122; ++i) {
            URLENCODER.set(i);
        }
        for (i = 65; i <= 90; ++i) {
            URLENCODER.set(i);
        }
        for (i = 48; i <= 57; ++i) {
            URLENCODER.set(i);
        }
        URLENCODER.set('-');
        URLENCODER.set('_');
        URLENCODER.set('.');
        URLENCODER.set('~');
    }
    
    public static void main(String[] args) throws Exception {
        // 火山官网密钥信息, 注意sk结尾有==
        String AccessKeyID = "AK*****";
        String SecretAccessKey = "******==";
        // 请求域名
        String endpoint = "visual.volcengineapi.com";
        String path = "/"; // 路径，不包含 Query// 请求接口信息
        String service = "cv";
        String region = "cn-north-1";
        String schema = "https";
        Sign sign = new Sign(region, service, schema, endpoint, path, AccessKeyID, SecretAccessKey);
        // 参考接口文档Query参数
        String action = "CVProcess";
        String version = "2022-08-31";
        Date date = new Date();
        // 参考接口文档Body参数
        JSONObject req=new JSONObject();
        req.put("req_key","xxx");
        ArrayList<String> imageUrls = new ArrayList<String>();
        imageUrls.add("******");
        req.put("image_urls",imageUrls);
        req.put("prompt","******");

        sign.doRequest("POST", new HashMap(), req.toJSONString().getBytes(), date, action, version);
    }

    public Sign(String region, String service, String schema, String host, String path, String ak, String sk) {
        this.region = region;
        this.service = service;
        this.host = host;
        this.schema = schema;
        this.path = path;
        this.ak = ak;
        this.sk = sk;
    }

    public void doRequest(String method, Map<String, String> queryList, byte[] body,
                          Date date, String action, String version) throws Exception {
        if (body == null) {
            body = new byte[0];
        }
        String xContentSha256 = hashSHA256(body);
        SimpleDateFormat sdf = new SimpleDateFormat("yyyyMMdd'T'HHmmss'Z'");
        sdf.setTimeZone(TimeZone.getTimeZone("GMT"));
        String xDate = sdf.format(date);
        String shortXDate = xDate.substring(0, 8);
        String contentType = "application/json";
        String signHeader = "host;x-date;x-content-sha256;content-type";

        SortedMap<String, String> realQueryList = new TreeMap<>(queryList);
        realQueryList.put("Action", action);
        realQueryList.put("Version", version);
        StringBuilder querySB = new StringBuilder();
        for (String key : realQueryList.keySet()) {
            querySB.append(signStringEncoder(key)).append("=").append(signStringEncoder(realQueryList.get(key))).append("&");
        }
        querySB.deleteCharAt(querySB.length() - 1);

        String canonicalStringBuilder = method + "\n" + path + "\n" + querySB + "\n" +
                "host:" + host + "\n" +
                "x-date:" + xDate + "\n" +
                "x-content-sha256:" + xContentSha256 + "\n" +
                "content-type:" + contentType + "\n" +
                "\n" +
                signHeader + "\n" +
                xContentSha256;

        System.out.println(canonicalStringBuilder);

        String hashcanonicalString = hashSHA256(canonicalStringBuilder.getBytes());
        String credentialScope = shortXDate + "/" + region + "/" + service + "/request";
        String signString = "HMAC-SHA256" + "\n" + xDate + "\n" + credentialScope + "\n" + hashcanonicalString;

        byte[] signKey = genSigningSecretKeyV4(sk, shortXDate, region, service);
//        String signature = HexFormat.of().formatHex(hmacSHA256(signKey, signString));
        String signature = Hex.encodeHexString(Utils.hmacSHA256(signKey, signString));

        URL url = new URL(schema + "://" + host + path + "?" + querySB);

        HttpURLConnection conn = (HttpURLConnection) url.openConnection();
        conn.setRequestMethod(method);
        conn.setRequestProperty("Host", host);
        conn.setRequestProperty("X-Date", xDate);
        conn.setRequestProperty("X-Content-Sha256", xContentSha256);
        conn.setRequestProperty("Content-Type", contentType);
        conn.setRequestProperty("Authorization", "HMAC-SHA256" +
                " Credential=" + ak + "/" + credentialScope +
                ", SignedHeaders=" + signHeader +
                ", Signature=" + signature);
        if (!Objects.equals(conn.getRequestMethod(), "GET")) {
            conn.setDoOutput(true);
            OutputStream os = conn.getOutputStream();
            os.write(body);
            os.flush();
            os.close();
        }
        conn.connect();

        int responseCode = conn.getResponseCode();

        InputStream is;
        if (responseCode == 200) {
            is = conn.getInputStream();
        } else {
            is = conn.getErrorStream();
        }
        String responseBody = new String(ByteStreams.toByteArray(is));
        is.close();

        System.out.println(responseCode);
        System.out.println(responseBody);
    }
    
    private String signStringEncoder(String source) {
        if (source == null) {
            return null;
        }
        StringBuilder buf = new StringBuilder(source.length());
        ByteBuffer bb = UTF_8.encode(source);
        while (bb.hasRemaining()) {
            int b = bb.get() & 255;
            if (URLENCODER.get(b)) {
                buf.append((char) b);
            } else if (b == 32) {
                buf.append("%20");
            } else {
                buf.append("%");
                char hex1 = CONST_ENCODE.charAt(b >> 4);
                char hex2 = CONST_ENCODE.charAt(b & 15);
                buf.append(hex1);
                buf.append(hex2);
            }
        }
        
        return buf.toString();
    }

    public static String hashSHA256(byte[] content) throws Exception {
        try {
            MessageDigest md = MessageDigest.getInstance("SHA-256");


            return Hex.encodeHexString(md.digest(content));
        } catch (Exception e) {
            throw new Exception(
                    "Unable to compute hash while signing request: "
                            + e.getMessage(), e);
        }
    }

    public static byte[] hmacSHA256(byte[] key, String content) throws Exception {
        try {
            Mac mac = Mac.getInstance("HmacSHA256");
            mac.init(new SecretKeySpec(key, "HmacSHA256"));
            return mac.doFinal(content.getBytes());
        } catch (Exception e) {
            throw new Exception(
                    "Unable to calculate a request signature: "
                            + e.getMessage(), e);
        }
    }

    private byte[] genSigningSecretKeyV4(String secretKey, String date, String region, String service) throws Exception {
        byte[] kDate = hmacSHA256((secretKey).getBytes(), date);
        byte[] kRegion = hmacSHA256(kDate, region);
        byte[] kService = hmacSHA256(kRegion, service);
        return hmacSHA256(kService, "request");
    }
}
```

<span id="#652553ce"></span>
## Golang
```Go
/*
Copyright (year) Beijing Volcano Engine Technology Ltd.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
*/
package main

import (
        "bytes"
        "crypto/hmac"
        "crypto/sha256"
        "encoding/hex"
        "encoding/json"
        "fmt"
        "log"
        "net/http"
        "net/http/httputil"
        "net/url"
        "strings"
        "time"
)

const (
        // 请求凭证，从访问控制申请
        AccessKeyID     = "AK*****"
        SecretAccessKey = "*****=="

        // 请求地址
        Addr = "https://visual.volcengineapi.com"
        Path = "/" // 路径，不包含 Query

        // 请求接口信息
        Service = "cv"
        Region  = "cn-north-1"

        // 请求Query信息
        Action  = "CVProcess"
        Version = "2022-08-31"
)

func hmacSHA256(key []byte, content string) []byte {
        mac := hmac.New(sha256.New, key)
        mac.Write([]byte(content))
        return mac.Sum(nil)
}

func getSignedKey(secretKey, date, region, service string) []byte {
        kDate := hmacSHA256([]byte(secretKey), date)
        kRegion := hmacSHA256(kDate, region)
        kService := hmacSHA256(kRegion, service)
        kSigning := hmacSHA256(kService, "request")

        return kSigning
}

func hashSHA256(data []byte) []byte {
        hash := sha256.New()
        if _, err := hash.Write(data); err != nil {
                log.Printf("input hash err:%s", err.Error())
        }

        return hash.Sum(nil)
}

func doRequest(method string, queries url.Values, body []byte) ([]byte, int, error) {
        // 1. 构建请求
        queries.Set("Action", Action)
        queries.Set("Version", Version)
        requestAddr := fmt.Sprintf("%s%s?%s", Addr, Path, queries.Encode())
        log.Printf("request addr: %s\n", requestAddr)

        request, err := http.NewRequest(method, requestAddr, bytes.NewBuffer(body))
        if err != nil {
                return nil, 0, fmt.Errorf("bad request: %w", err)
        }

        // 2. 构建签名材料
        now := time.Now()
        date := now.UTC().Format("20060102T150405Z")
        authDate := date[:8]
        request.Header.Set("X-Date", date)

        payload := hex.EncodeToString(hashSHA256(body))
        request.Header.Set("X-Content-Sha256", payload)
        request.Header.Set("Content-Type", "application/json")

        queryString := strings.Replace(queries.Encode(), "+", "%20", -1)
        signedHeaders := []string{"host", "x-date", "x-content-sha256", "content-type"}
        var headerList []string
        for _, header := range signedHeaders {
                if header == "host" {
                        headerList = append(headerList, header+":"+request.Host)
                } else {
                        v := request.Header.Get(header)
                        headerList = append(headerList, header+":"+strings.TrimSpace(v))
                }
        }
        headerString := strings.Join(headerList, "\n")

        canonicalString := strings.Join([]string{
                method,
                Path,
                queryString,
                headerString + "\n",
                strings.Join(signedHeaders, ";"),
                payload,
        }, "\n")
        log.Printf("canonical string:\n%s\n", canonicalString)

        hashedCanonicalString := hex.EncodeToString(hashSHA256([]byte(canonicalString)))
        log.Printf("hashed canonical string: %s\n", hashedCanonicalString)

        credentialScope := authDate + "/" + Region + "/" + Service + "/request"
        signString := strings.Join([]string{
                "HMAC-SHA256",
                date,
                credentialScope,
                hashedCanonicalString,
        }, "\n")
        log.Printf("sign string:\n%s\n", signString)

        // 3. 构建认证请求头
        signedKey := getSignedKey(SecretAccessKey, authDate, Region, Service)
        signature := hex.EncodeToString(hmacSHA256(signedKey, signString))
        log.Printf("signature: %s\n", signature)

        authorization := "HMAC-SHA256" +
                " Credential=" + AccessKeyID + "/" + credentialScope +
                ", SignedHeaders=" + strings.Join(signedHeaders, ";") +
                ", Signature=" + signature

        request.Header.Set("Authorization", authorization)
        log.Printf("authorization: %s\n", authorization)

        // 4. 打印请求，发起请求
        requestRaw, err := httputil.DumpRequest(request, true)
        if err != nil {
                return nil, 0, fmt.Errorf("dump request err: %w", err)
        }

        log.Printf("request:\n%s\n", string(requestRaw))

        response, err := http.DefaultClient.Do(request)
        if err != nil {
                return nil, 0, fmt.Errorf("do request err: %w", err)
        }
        // 5. 打印响应
        responseRaw, err := httputil.DumpResponse(response, true)
        if err != nil {
                return nil, 0, fmt.Errorf("dump response err: %w", err)
        }
        respStr := strings.ReplaceAll(string(responseRaw), "\\u0026", "&")
        log.Printf("response:\n%s\n", respStr)
        return requestRaw, response.StatusCode, err
}

func main() {
        // 请求Body信息，参考接口文档请求示例
        reqBody := map[string]interface{}{
                "req_key": "*****",
                //......
        }

        reqBodyStr, _ := json.Marshal(reqBody)
        _, _, _ = doRequest("POST", url.Values{}, reqBodyStr)
}
```

<span id="#0f05efc9"></span>
## Python
```Python
import json
import sys
import os
import base64
import datetime
import hashlib
import hmac
import requests


method = 'POST'
host = 'visual.volcengineapi.com'
region = 'cn-north-1'
endpoint = 'https://visual.volcengineapi.com'
service = 'cv'

def sign(key, msg):
    return hmac.new(key, msg.encode('utf-8'), hashlib.sha256).digest()

def getSignatureKey(key, dateStamp, regionName, serviceName):
    kDate = sign(key.encode('utf-8'), dateStamp)
    kRegion = sign(kDate, regionName)
    kService = sign(kRegion, serviceName)
    kSigning = sign(kService, 'request')
    return kSigning

def formatQuery(parameters):
    request_parameters_init = ''
    for key in sorted(parameters):
        request_parameters_init += key + '=' + parameters[key] + '&'
    request_parameters = request_parameters_init[:-1]
    return request_parameters

def signV4Request(access_key, secret_key, service, req_query, req_body):
    if access_key is None or secret_key is None:
        print('No access key is available.')
        sys.exit()

    t = datetime.datetime.utcnow()
    current_date = t.strftime('%Y%m%dT%H%M%SZ')
    # current_date = '20210818T095729Z'
    datestamp = t.strftime('%Y%m%d')  # Date w/o time, used in credential scope
    canonical_uri = '/'
    canonical_querystring = req_query
    signed_headers = 'content-type;host;x-content-sha256;x-date'
    payload_hash = hashlib.sha256(req_body.encode('utf-8')).hexdigest()
    content_type = 'application/json'
    canonical_headers = 'content-type:' + content_type + '\n' + 'host:' + host + \
        '\n' + 'x-content-sha256:' + payload_hash + \
        '\n' + 'x-date:' + current_date + '\n'
    canonical_request = method + '\n' + canonical_uri + '\n' + canonical_querystring + \
        '\n' + canonical_headers + '\n' + signed_headers + '\n' + payload_hash
    # print(canonical_request)
    algorithm = 'HMAC-SHA256'
    credential_scope = datestamp + '/' + region + '/' + service + '/' + 'request'
    string_to_sign = algorithm + '\n' + current_date + '\n' + credential_scope + '\n' + hashlib.sha256(
        canonical_request.encode('utf-8')).hexdigest()
    # print(string_to_sign)
    signing_key = getSignatureKey(secret_key, datestamp, region, service)
    # print(signing_key)
    signature = hmac.new(signing_key, (string_to_sign).encode(
        'utf-8'), hashlib.sha256).hexdigest()
    # print(signature)

    authorization_header = algorithm + ' ' + 'Credential=' + access_key + '/' + \
        credential_scope + ', ' + 'SignedHeaders=' + \
        signed_headers + ', ' + 'Signature=' + signature
    # print(authorization_header)
    headers = {'X-Date': current_date,
               'Authorization': authorization_header,
               'X-Content-Sha256': payload_hash,
               'Content-Type': content_type
               }
    # print(headers)

    # ************* SEND THE REQUEST *************
    request_url = endpoint + '?' + canonical_querystring

    print('\nBEGIN REQUEST++++++++++++++++++++++++++++++++++++')
    print('Request URL = ' + request_url)
    try:
        r = requests.post(request_url, headers=headers, data=req_body)
    except Exception as err:
        print(f'error occurred: {err}')
        raise
    else:
        print('\nRESPONSE++++++++++++++++++++++++++++++++++++')
        print(f'Response code: {r.status_code}\n')
        # 使用 replace 方法将 \u0026 替换为 &
        resp_str = r.text.replace("\\u0026", "&")
        print(f'Response body: {resp_str}\n')


if __name__ == "__main__":
    # 请求凭证，从访问控制申请
    access_key = 'AK*****'
    secret_key = '*****=='

    # 请求Query，按照接口文档中填入即可
    query_params = {
        'Action': 'CVProcess',
        'Version': '2022-08-31',
    }
    formatted_query = formatQuery(query_params)

    # 请求Body，按照接口文档中填入即可
    body_params = {
        "req_key": "******",
        # ......
    }
    formatted_body = json.dumps(body_params)
    
    signV4Request(access_key, secret_key, service,
                  formatted_query, formatted_body)
```

<span id="#c2bce9df"></span>
## PHP
```PHP
<?php
/**
 * Copyright (year) Beijing Volcano Engine Technology Ltd.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
require('../vendor/autoload.php');
// 需要自行安装 composer（https://getcomposer.org/doc/00-intro.md），并安装GuzzleHttp依赖， composer require guzzlehttp/guzzle:^7.0
use GuzzleHttp\Client;
use GuzzleHttp\Exception\GuzzleException;

// 基础信息，基本不用变更
$Host = "visual.volcengineapi.com";
$ContentType = "application/json";
$Service = "cv";
$Region = "cn-north-1";

/**
 * @throws GuzzleException
 */
// 第一步：创建一个  API 请求函数。签名计算的过程包含在该函数中。
function request($method, $query, $header, $ak, $sk, $action, $version, $body)
{
    // 第二步：创建身份证明。其中的 Service 和 Region 字段是固定的。ak 和 sk 分别代表
    // AccessKeyID 和 SecretAccessKey。同时需要初始化签名结构体。一些签名计算时需要的属性也在这里处理。
    // 初始化身份证明结构体
    global $Service, $Region, $Host, $ContentType;
    $credential = [
        'accessKeyId' => $ak,
        'secretKeyId' => $sk,
        'service' => $Service,
        'region' => $Region,
    ];
    // 初始化签名结构体
    $query = array_merge($query, [
        'Action' => $action,
        'Version' => $version
    ]);
    ksort($query);
    $requestParam = [
        // body是http请求需要的原生body
        'body' => $body,
        'host' => $Host,
        'path' => '/',
        'method' => $method,
        'contentType' => $ContentType,
        'date' => gmdate('Ymd\THis\Z'),
        'query' => $query
    ];
    // 第三步：接下来开始计算签名。在计算签名前，先准备好用于接收签算结果的 signResult 变量，并设置一些参数。
    // 初始化签名结果的结构体
    $xDate = $requestParam['date'];
    $shortXDate = substr($xDate, 0, 8);
    $xContentSha256 = hash('sha256', $requestParam['body']);
    $signResult = [
        'Host' => $requestParam['host'],
        'X-Content-Sha256' => $xContentSha256,
        'X-Date' => $xDate,
        'Content-Type' => $requestParam['contentType']
    ];
    // 第四步：计算 Signature 签名。
    $signedHeaderStr = join(';', ['content-type', 'host', 'x-content-sha256', 'x-date']);
    $canonicalRequestStr = join("\n", [
        $requestParam['method'],
        $requestParam['path'],
        http_build_query($requestParam['query']),
        join("\n", ['content-type:'. $requestParam['contentType'], 'host:'. $requestParam['host'], 'x-content-sha256:'. $xContentSha256, 'x-date:'. $xDate]),
        '',
        $signedHeaderStr,
        $xContentSha256
    ]);
    $hashedCanonicalRequest = hash("sha256", $canonicalRequestStr);
    $credentialScope = join('/', [$shortXDate, $credential['region'], $credential['service'], 'request']);
    $stringToSign = join("\n", ['HMAC-SHA256', $xDate, $credentialScope, $hashedCanonicalRequest]);
    $kDate = hash_hmac("sha256", $shortXDate, $credential['secretKeyId'], true);
    $kRegion = hash_hmac("sha256", $credential['region'], $kDate, true);
    $kService = hash_hmac("sha256", $credential['service'], $kRegion, true);
    $kSigning = hash_hmac("sha256", 'request', $kService, true);
    $signature = hash_hmac("sha256", $stringToSign, $kSigning);
    $signResult['Authorization'] = sprintf("HMAC-SHA256 Credential=%s, SignedHeaders=%s, Signature=%s", $credential['accessKeyId']. '/'. $credentialScope, $signedHeaderStr, $signature);
    $header = array_merge($header, $signResult);
    // 第五步：将 Signature 签名写入 HTTP Header 中，并发送 HTTP 请求。
    $client = new Client([
        'base_uri' => 'https://'. $requestParam['host'],
        'timeout' => 120.0,
    ]);
    $response = $client->request($method, 'https://'. $requestParam['host']. $requestParam['path'], [
        'headers' => $header,
        'query' => $requestParam['query'],
        'body' => $requestParam['body']
    ]);
    $responseContent = $response->getBody()->getContents();
    // 转换 \u0026 为 &
    $responseContent = str_replace('\u0026', '&', $responseContent);
    return $responseContent;
}
$now = time();
// 火山官网密钥信息, 注意sk结尾有==
$AccessKeyID = 'AK*****';
$SecretAccessKey = '*****==';

// 参考接口文档Query参数
$action = "CVProcess";
$version = "2022-08-31";

// 参考接口文档Body参数
$requestBody = [
    "req_key" => "******",
    //......
];
$body = json_encode($requestBody);

try {
    $response = request("POST", [], [], $AccessKeyID, $SecretAccessKey, $action, $version, $body);
    print_r($response);
} catch (GuzzleException $e) {
    print_r($e->getResponse()->getBody()->getContents() . "\n");
}
```



